<!DOCTYPE html>
<html>

<head>
  <!--Import Google Icon Font-->
  <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="materialize/css/materialize.min.mod.css"  media="screen,projection"/>
  <!--Import event expand view css-->
  <link type="text/css" rel="stylesheet" href="materialize/css/expandview.css"/>
  <link type="text/css" rel="stylesheet" href="mainPage.css"/>

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <meta charset="UTF-8">
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script defer src="http://maps.google.com/maps/api/js?key=AIzaSyB6Lz24NEsy8I_cDxm6vUVGXlqwNlkC2yk&language=en"></script>
  <script src="jqueryGoogleMapAPI/jquery.googlemap.js"></script>
</head>

<body style="height:800px">
  <script type="text/javascript" src="materialize/js/materialize.min.js"></script>

  <script>
    //document.ready
    $(function(){
      //Script that allows modals to work
      // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
      $('.modal-trigger').leanModal();

      //Script that allows date to work
      $('.datepicker').pickadate({
        selectMonths: true, // Creates a dropdown to control month
        selectYears: 16 // Creates a dropdown of 15 years to control year
      });

      //Script that send search data to server
      $('#search').click(function(){
        var newStartDateString, newEndDateString;
        if ($('#startDate').val() == ""){
          var fullDate = new Date()
          //convert month to 2 digits
          var twoDigitMonth = ((fullDate.getMonth().length+1) === 1)? (fullDate.getMonth()+1) : '0' + (fullDate.getMonth()+1);
          newStartDateString = fullDate.getFullYear() + "/" + twoDigitMonth + "/" + fullDate.getDate();
        } else {
          newStartDateString = "Y/M/D";
          var startDateString = $('#startDate').val().split(/[,]? /);
          var newMonth =  "JanFebMarAprMayJunJulAugSepOctNovDec".indexOf(startDateString[1].substring(0,3))/3+1;
          newStartDateString = newStartDateString
            .replace("D", startDateString[0]<10 ? "0"+startDateString[0] : startDateString[0])
            .replace("M", newMonth<10 ? "0"+newMonth : newMonth)
            .replace("Y", startDateString[2]);
        }
        if ($('#endDate').val() == "") {
          newEndDateString = "nnull";
        } else {
          newEndDateString = "Y/M/D";
          var endDateString = $('#endDate').val().split(/[,]? /);
          var newMonth =  "JanFebMarAprMayJunJulAugSepOctNovDec".indexOf(endDateString[1].substring(0,3))/3+1;
          newEndDateString = newEndDateString
            .replace("D", endDateString[0]<10 ? "0"+endDateString[0] : endDateString[0])
            .replace("M", newMonth<10 ? "0"+newMonth : newMonth)
            .replace("Y", endDateString[2]);
        }
        console.log(newStartDateString);
        console.log(newEndDateString);

        var majorString = $('#major').val()==null ? 'nnull' : $('#major').val();
        var categoryString = $('#category').val()=="" ? 'nnull' : $('#category').val();
        console.log(majorString);
        console.log(categoryString);

        $.ajax({
          type: "POST",
          url: "getPostingListByFilter.php",
          data: {
            major: majorString,
            category: categoryString,
            startDate: newStartDateString,
            endDate: newEndDateString
          },
          success: function(result, status, xhr) {
            //TO BE IMPLEMENTED
            console.log("Data: " + data) + "\nStatus: " + status;
          },
          error: function(xhr, status, error) {
            alert("An error occured: " + xhr.status + " " + xhr.statusText);
          }
        });
      });
      //Script that allows select to work
      $('select').material_select();

      //googleMapAPI
      $('#mapholder')
        .googleMap({
          coords: [36.9923454, -122.0613478],
          zoom: 15,
          type: "ROADMAP",
          scrollwheel: true
        });
    });
  </script>

  
  <nav>
    <div class="nav-wrapper" style="background-color:#71ABA7;">
      <a href="#" class="brand-logo left"><img src="../images/png/logo.png" height="20px" width="80px" style="margin-left:20px;"></img></a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li style="margin-right:1rem;">
          <select id="major">
            <option value="" disabled selected>Major</option>
            <option value="Art">Art</option>
            <option value="Biology">Biology</option>
            <option value="Computer Science">Computer Science</option>
            <option value="Economics">Economics</option>
            <option value="History">History</option>
            <option value="Mathematics">Mathematics</option>
            <option value="Physics">Physics</option>
          </select>
        </li>
        <li style="margin-right:1rem">
          <select id="category" multiple>
            <option value="" disabled selected>Category</option>
            <option value="Sport">Sport</option>
            <option value="Game">Game</option>
            <option value="Party">Party</option>
            <option value="Study">Study</option>
            <option value="etc">etc</option>
          </select>
        </li>
        <li style="margin-right:1rem">
          <input id="startDate" placeholder="start date" type="date" class="datepicker"></input>
        </li>
        <li>
          <input id="endDate" placeholder="end date" type="date" class="datepicker"></input>
        </li>
        <li style="margin-right:2rem;">
          <a id="search" style="height:40px; width:50px;"><img src="../images/png/search.png" height="20px" width="20px" style="margin-top:10px"></img></a>
        </li>
        <li>
          <a href="#!" style="height:40px; width:50px;">
            <img src="../images/png/notification.png" height="25px" width="20px" style="margin-top:7px;" />
          </a>
        </li>
        <li>
          <ul id="dropdown1" class="dropdown-content">
            <li><a href="#!">one<span class="badge">3</span></a></li>
            <li><a href="#!">two</a></li>
            <li class="divider"></li>
            <li><a href="#!">Logout</a></li>
          </ul>
          <a href="#!" class="dropdown-button" style="height:40px; width:50px; margin-right:10px;" data-activates="dropdown1">
            <img src="../images/png/gear.png" height="25px" width="25px" style="margin-top:7px;" />
          </a>
        </li>
      </ul>
    </div>
  </nav>
  <main class="row" style="height:87%;">
    <!-- Map -->
    <section class="col s12 l9 push-l3" id="mapholder"></section>
    <!-- Events -->
    <aside class="col s12 l3 pull-l9">
      <ul class="collapsible collapsible-event">
        <li>
          <a onClick="toggleHeader('evt1');" id="evt1Header" class="collapsible-header betweenGreenDeep-text eventHeader">
            <h1> Title </h1>
            <div id="evt1Rating" class="eventRating hide">
              <h3 id="evt1RatingNum">3.5</h3>
            </div>
            <p id="evt1Owner" class="eventOwner hide"> event creator name </p>
          </a>
          <div class="collapsible-body" class="hide">
            <div class="row">
              <a onClick="joinEvent('evt1');" class="joinBtn">
                <div class="col s4">
                  <i class="betweenGreenDeep-text material-icons eventIcons large">open_in_browser</i>
                  <h5 class="betweenGreenDeep-text center-align"> Enter </h5>
                </div>
              </a>
              <a onClick="messageOwner('evt1');" class="messageBtn">
                <div class="col s4">
                  <i class="betweenGreenDeep-text material-icons eventIcons large">email</i>
                  <h5 class="betweenGreenDeep-text center-align"> Message </h5>
                </div>
              </a>
              <a onClick="shareEvent('evt1');" class="shareBtn">
                <div class="col s4">
                  <i class="betweenGreenDeep-text material-icons eventIcons large">share</i>
                  <h5 class="betweenGreenDeep-text center-align"> Share </h5>
                </div>
              </a>
            </div>
            <hr class="sectionDivider" />
            <div class="row">
              <div class="col s12">
                <p class="eventDescription">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit...<a onClick="moreInfo('evt1');">more info</a></p>
              </div>
            </div>
            <div class="row">
              <div class="eventDetails col s1 offset-s1">
                <i class="betweenGreenDeep-text material-icons eventDetails medium">schedule</i>
              </div>
              <div class="eventDetails col s9">
                <p id="evt1time">time</p>
              </div>
            </div>
            <div class="row">
              <div class="eventDetails col s1 offset-s1">
                <i class="betweenGreenDeep-text material-icons eventDetails medium">perm_identity</i>
              </div>
              <div class="eventDetails col s9">
                <p id="evt1time">attendance</p>
              </div>
            </div>
            <div class="row">
              <div class="eventDetails col s1 offset-s1">
                <i class="betweenGreenDeep-text material-icons eventDetails medium">location_on</i>
              </div>
              <div class="eventDetails col s9">
                <p id="evt1time">location</p>
              </div>
            </div>
            <div class="row">
              <div class="eventDetails col s1 offset-s1">
                <i class="betweenGreenDeep-text material-icons eventDetails medium">home</i>
              </div>
              <div class="eventDetails col s9">
                <p id="evt1time">homepage</p>
              </div>
            </div>
            <hr class="sectionDivider" />
            <div class="row">
              <div id="evt1Reviews" class="eventReviews col s12">
                <h1 class="betweenGreenDeep-text"> Reviews </h1>
              </div>
              <div class="eventRatings col s10 offset-s1">
                <p>5</p>
                <p>4</p>
                <p>3</p>
                <p>2</p>
                <p>1</p>
              </div>
            </div>
            <div class="row">
              <div id="evt1Replies" class="eventReplies col s12">
                <h1 class="betweenGreenDeep-text"> Reply </h1>
              </div>
            </div>
          </div>
        </li>
        <li>
          <a onClick="toggleHeader('evt2');" id="evt2Header" class="collapsible-header betweenGreenDeep-text eventHeader">
            <h1> Title </h1>
            <div id="evt2Rating" class="eventRating hide">
              <h3 id="evt2RatingNum">3.5</h3>
            </div>
            <p id="evt2Owner" class="eventOwner hide"> event creator name </p>
          </a>
          <div class="collapsible-body">
            <p>Lorem ipsum dolor sit amet.</p>
          </div>
        </li>
        <li>
          <a onClick="toggleHeader('evt3');" id="evt3Header" class="collapsible-header betweenGreenDeep-text eventHeader">
            <h1> Title </h1>
            <div id="evt3Rating" class="eventRating hide">
              <h3 id="evt3RatingNum">3.5</h3>
            </div>
            <p id="evt3Owner" class="eventOwner hide"> event creator name </p>
          </a>
          <div class="collapsible-body">
            <p>Lorem ipsum dolor sit amet.</p>
          </div>
        </li>
        
      </ul>
    </aside>
  </main>
  
  <script src="ExpandedView.js"></script>
</body>

</html>
